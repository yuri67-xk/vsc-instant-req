# Instant Req

Claude Codeの要件定義から実装まで一貫したプロンプトを即座に生成するVSCode Extension

## 概要

このVSCode拡張機能は、Claude Codeの**Plan Mode**と**Subagents**を活用した、要件定義から実装、課題探索まで完全な開発フローを網羅するプロンプトを簡単に生成できるツールです。サイドパネルから直接アクセスでき、要件や課題を入力し適切なエージェントを選択するだけで、最適化されたプロンプトを自動生成します。

## 主な機能

### デュアルモードシステム
- **要件定義モード**: 機能要件に基づく開発フロー
- **課題探索モード**: 既存システムの課題発見と改善フロー

### コア機能
- **サイドパネル統合**: VSCodeのサイドバーから常時アクセス可能
- **タブ切り替え**: 要件定義と課題探索をシームレスに切り替え
- **ネストタブ**: 入力タブとエージェントタブでUIを整理

### 入力機能
- **動的な入力管理**:
  - 複数の要件/課題を追加・削除可能
  - 各項目を個別に編集
  - 全入力CLEAR機能
- **編集可能なプロンプト出力**:
  - 生成後のプロンプトを直接編集可能
  - 編集/完了モードの切り替え
  - 編集内容をそのままコピー可能

### エージェント選択
- **プリセットエージェント**: ドロップダウンから選択
- **カスタムエージェント**:
  - 手動入力対応（@プレフィックス自動付与）
  - 最近使用したカスタムエージェントの履歴表示（最新10件）
- **コンテキスト別エージェント**:
  - 仕様設計担当
  - 実装担当
  - 課題探索担当
  - コードレビュー担当

### ステージ設定システム
- **カスタマイズ可能なワークフロー**:
  - モーダルUIで直感的な編集
  - メインステージとサブステージの階層構造
  - ドラッグ&ドロップで順序変更（予定）
  - デフォルト設定にリセット機能
- **動的プレースホルダー**:
  - `{agent-仕様設計担当}` などのプレースホルダーを自動検出
  - 選択したエージェントに自動置換

### ワンクリック操作
- **COPYボタン**: 生成/編集したプロンプトをクリップボードにコピー
- **CLEARボタン**: 全入力を一括クリア
- **編集ボタン**: プロンプトの編集モード切り替え

## インストール

### 手動インストール

```bash
# リポジトリをクローン
git clone https://github.com/yourusername/instant-req.git
cd instant-req

# 依存関係をインストール
npm install

# VSIXファイルをビルド
npx vsce package

# インストール
code --install-extension instant-req-1.0.0.vsix
```

## 使い方

### 基本的な使い方

#### 要件定義モード

1. **サイドパネルを開く**
   - VSCodeのアクティビティバー（左端）にある「Instant Req」アイコンをクリック

2. **「要件定義」タブを選択**（デフォルト）

3. **機能要件を入力**
   - 「入力」タブで要件を入力
   - 「+ 要件を追加」ボタンで複数の要件を追加可能
   - 不要な要件は×ボタンで削除

4. **エージェントを選択**
   - 「エージェント」タブに切り替え
   - 各エージェント（仕様設計担当、実装担当、コードレビュー担当）を選択
   - プリセットから選択、または手動でカスタムエージェント名を入力

5. **プロンプトを生成**
   - 「プロンプト発行」ボタンをクリック
   - プロンプト本文が表示される

6. **必要に応じて編集**
   - 「編集」ボタンをクリックして編集モードに切り替え
   - プロンプトを直接編集
   - 「完了」ボタンで編集モードを終了

7. **コピー**
   - 「COPY」ボタンでクリップボードにコピー
   - Claude Codeに貼り付けて実行

#### 課題探索モード

1. **「課題探索」タブを選択**

2. **課題を入力**
   - 「入力」タブで課題を入力
   - 「+ 課題を追加」ボタンで複数の課題を追加可能

3. **エージェントを選択**
   - 「エージェント」タブに切り替え
   - 探索担当、仕様設計担当、実装担当、コードレビュー担当を選択

4. **プロンプト生成とコピー**
   - 要件定義モードと同様の手順

### ステージ設定のカスタマイズ

1. **ステージ設定を開く**
   - 「ステージ設定」ボタンをクリック

2. **ステージを編集**
   - メインステージ: 大きな工程を定義
   - サブステージ: 詳細なステップを追加
   - 「+ ステージを追加」で新規ステージを追加
   - 「+ サブステージを追加」で詳細を追加

3. **プレースホルダーの使用**
   - `{agent-仕様設計担当}` のような形式で記述
   - 選択したエージェントに自動置換される

4. **保存またはリセット**
   - 「保存」: 変更を保存
   -「デフォルトに戻す」: 初期設定に戻す
   - 「キャンセル」: 変更を破棄

### エージェントの選択方法

#### プリセットから選択
ドロップダウンメニューから既存のエージェントを選択：
- 最近使用（最新10件が自動表示）
- プリセット（設定ファイルで定義されたエージェント）
- カスタム（手動入力）

#### カスタムエージェントを手動入力
```
1. ドロップダウンで「カスタム」を選択
2. 手動入力フィールドに名前を入力
   入力: custom-agent
   ↓
   自動的に変換: @custom-agent
3. 使用したカスタムエージェントは自動的に履歴に保存される
```

## カスタマイズ

### エージェントの追加

VSCodeの設定（`settings.json`）で独自のエージェントを追加できます：

```json
{
  "instantReq.agents.specWriters": [
    {
      "id": "@custom-architect",
      "name": "Custom Architect"
    },
    {
      "id": "@api-designer",
      "name": "API Designer"
    }
  ],
  "instantReq.agents.implementers": [
    {
      "id": "@custom-dev",
      "name": "Custom Developer"
    }
  ],
  "instantReq.agents.issueExplorers": [
    {
      "id": "@issue-analyzer",
      "name": "Issue Analyzer"
    }
  ],
  "instantReq.agents.codeReviewers": [
    {
      "id": "@security-reviewer",
      "name": "Security Reviewer"
    }
  ]
}
```

### 設定項目

- `instantReq.agents.specWriters`: 仕様書作成用エージェント
- `instantReq.agents.implementers`: 実装用エージェント
- `instantReq.agents.issueExplorers`: 課題探索用エージェント
- `instantReq.agents.codeReviewers`: コードレビュー用エージェント

各エージェントは以下の形式：
```json
{
  "id": "@agent-id",  // @プレフィックス必須
  "name": "Agent Name"
}
```

## 生成されるプロンプトの例

### 要件定義モードの場合

```
1. 以下の要件に基づいて機能を開発すること。
  - ユーザー認証機能を追加
  - ダッシュボード画面を作成
  - データエクスポート機能を実装

2. 上記の要件を詳細にPlanningして、開発計画を提示すること。

3. Planning結果をユーザーが承認したら、 @architect に仕様設計書を作成させること。
  - 仕様設計書の作成にあたり、docs/specs/フォルダ配下にあるサブフォルダへ仕様設計書を保存すること。
  - 最適なサブフォルダが存在しない場合は、新規にサブフォルダを作成すること。
  - 仕様設計書には、実装方針、API設計、データ構造、テストケースも含めること。

4. 仕様設計書の作成が完了したら、 @backend-dev にその仕様設計書に基づいて実装を行うこと。

5. 実装が完了したら、 @code-reviewer を起動して、コードレビューを実施すること。

6. コードレビューが完了したら、ユーザーに最終成果物を提出すること。
  - 簡便な成果報告を添えること。
  - 簡便なテストケース概要を添えること。
  - Git Commit Messageの提案を添えること。

7. 注意事項
  - 各エージェントの出力は必ず次のエージェントへのインプットとして使用されるため、正確かつ詳細に記述すること。
  - 成果物提出後は、ユーザーがテストを行うため、Git Commitを実行しないこと。
```

## 開発

### 必要な環境

- Node.js 20.x以上
- VSCode 1.80.0以上

### 開発セットアップ

```bash
# 依存関係をインストール
npm install

# Webview（TypeScript）をビルド
npm run compile:webview

# Extension全体をビルド
npm run compile

# VSCodeでデバッグモードで起動
# F5キーを押す、または「実行とデバッグ」から起動
```

### ビルド

```bash
# Webviewのみビルド（開発中）
npm run compile:webview

# パッケージング
npx vsce package

# 出力: instant-req-1.0.0.vsix
```

### リント

```bash
npm run lint
```

## プロジェクト構造

```
instant-req/
├── src/
│   ├── extension.ts                    # Extension エントリーポイント
│   ├── providers/
│   │   └── InstantReqViewProvider.ts   # WebviewView プロバイダー
│   ├── types/
│   │   └── settings.ts                 # 型定義
│   ├── config/
│   │   └── defaultStages.json          # デフォルトステージ設定
│   └── webview/
│       ├── index.html                  # WebviewのHTML
│       ├── styles.css                  # スタイルシート
│       ├── main.ts                     # Webviewメインロジック
│       ├── components/                 # コンポーネント
│       │   ├── TabManager.ts           # タブ管理
│       │   ├── AgentSelector.ts        # エージェント選択
│       │   ├── StageEditor.ts          # ステージ設定エディタ
│       │   ├── PromptGenerator.ts      # プロンプト生成
│       │   ├── RequirementsManager.ts  # 要件管理
│       │   └── IssuesManager.ts        # 課題管理
│       ├── types/
│       │   └── webview.ts              # Webview型定義
│       └── utils/
│           └── vscodeApi.ts            # VSCode API通信
├── out/                                # ビルド出力
├── package.json                        # Extension設定
├── tsconfig.json                       # TypeScript設定
├── build-webview.js                    # Webviewビルドスクリプト
└── README.md                           # このファイル
```

## 技術スタック

- **VSCode Extension API**: WebviewViewProvider
- **TypeScript**: 型安全な実装
- **esbuild**: 高速なWebviewビルド
- **VSCode Codicons**: アイコンシステム

## トラブルシューティング

### サイドパネルが表示されない

1. VSCodeをリロード（Ctrl/Cmd+R）
2. 拡張機能が有効になっているか確認
3. アクティビティバーに「Instant Req」アイコンが表示されているか確認

### エージェントが表示されない

1. VSCode設定を確認
2. `settings.json`の形式が正しいか確認（JSON構文エラーがないか）
3. VSCodeをリロード

### プロンプトがコピーできない

1. 要件/課題とエージェントがすべて入力されているか確認
2. ブラウザのクリップボード権限を確認

### ステージ設定が保存されない

1. モーダルで「保存」ボタンをクリックしたか確認
2. VSCodeの永続化ストレージの権限を確認

### プロンプトに `{agent-xxx}` がそのまま表示される

1. エージェントタブでエージェントを選択しているか確認
2. デフォルトで最初のエージェントが選択されているため、通常は発生しない

## ライセンス

MIT License

## 作者

Yuri QA67

## バージョン履歴

### 1.0.0 (2025-01-10)
- 正式リリース版
- デュアルモードシステム（要件定義/課題探索）
- ネストタブUI
- ステージ設定システム
- 編集可能なプロンプト出力
- エージェント履歴機能
- デフォルトエージェント自動選択
